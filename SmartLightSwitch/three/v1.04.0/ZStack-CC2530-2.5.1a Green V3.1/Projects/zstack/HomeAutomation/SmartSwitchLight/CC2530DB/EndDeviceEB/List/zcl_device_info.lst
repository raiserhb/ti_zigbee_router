###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         10/Nov/2015  10:33:08 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStack #
#                          -CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zstac #
#                          k\HomeAutomation\SmartSwitchLight\Source\zcl_devic #
#                          e_info.c                                           #
#    Command line       =  -f "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZS #
#                          tack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\HomeAutomation\SmartSwitchLight\CC2530DB\..\ #
#                          Tools\CC2530DB\f8wEndev.cfg" (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3         #
#                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3              #
#                          -DHAL_PA_LNA -DHAL_KEY=FALSE -DHAL_LED=FALSE       #
#                          -DHAL_LCD=FALSE -DHAL_ADC=FALSE -DNV_RESTORE       #
#                          -DNV_INIT) -f "F:\ZigBee                           #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\Tools\CC2530DB #
#                          \f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0            #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x02000000                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=TRUE -DPOLL_RATE=0            #
#                          -DQUEUED_POLL_RATE=0 -DRESPONSE_POLL_RATE=0        #
#                          -DREJOIN_POLL_RATE=440) -f "F:\ZigBee              #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\Tools\CC2530DB #
#                          \f8wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_REPORT  #
#                          -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF            #
#                          -DZCL_KEY_ESTABLISH -DZCL_KEY_ESTABLISHMENT_KEY_GE #
#                          NERATE_TIMEOUT=4 -DZCL_KEY_ESTABLISHMENT_MAC_GENER #
#                          ATE_TIMEOUT=10 -DZCL_KEY_ESTABLISHMENT_EKEY_GENERA #
#                          TE_TIMEOUT=10 -DZCL_LOAD_CONTROL                   #
#                          -DZCL_SIMPLE_METERING -DZCL_PRICING -DZCL_MESSAGE  #
#                          -DZCL_TUNNELING -DZCL_TOU) -DZCL_DEVICE_MGMT       #
#                          "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStac #
#                          k-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\HomeAutomation\SmartSwitchLight\Source\zcl_devi #
#                          ce_info.c" -lC "F:\ZigBee                          #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\EndDeviceEB\List\ #
#                          " -lA "F:\ZigBee Project\smartSwitch-light\v1.03.1 #
#                          \ZStack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\HomeAutomation\SmartSwitchLight\CC2530DB\ #
#                          EndDeviceEB\List\" --diag_suppress Pe001,Pa010 -o  #
#                          "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStac #
#                          k-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\HomeAutomation\SmartSwitchLight\CC2530DB\EndDev #
#                          iceEB\Obj\" -e --debug --core=plain --dptr=16,1    #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZS #
#                          tack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\HomeAutomation\SmartSwitchLight\CC2530DB\"   #
#                          -I "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZS #
#                          tack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\HomeAutomation\SmartSwitchLight\CC2530DB\..\ #
#                          Source\" -I "F:\ZigBee Project\smartSwitch-light\v #
#                          1.03.1\ZStack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\HomeAutomation\SmartSwitchLight\CC2 #
#                          530DB\..\..\Source\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\ZMain\TI #
#                          2530DB\" -I "F:\ZigBee Project\smartSwitch-light\v #
#                          1.03.1\ZStack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\HomeAutomation\SmartSwitchLight\CC2 #
#                          530DB\..\..\..\..\..\Components\hal\include\" -I   #
#                          "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStac #
#                          k-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\HomeAutomation\SmartSwitchLight\CC2530DB\..\..\ #
#                          ..\..\..\Components\hal\target\CC2530EB\" -I       #
#                          "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStac #
#                          k-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\HomeAutomation\SmartSwitchLight\CC2530DB\..\..\ #
#                          ..\..\..\Components\mac\include\" -I "F:\ZigBee    #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\high_level\" -I "F:\ZigBee            #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\low_level\srf04\" -I "F:\ZigBee       #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\low_level\srf04\single_chip\" -I      #
#                          "F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStac #
#                          k-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\HomeAutomation\SmartSwitchLight\CC2530DB\..\..\ #
#                          ..\..\..\Components\mt\" -I "F:\ZigBee             #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\osal\include\" -I "F:\ZigBee              #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\services\saddr\" -I "F:\ZigBee            #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\services\sdata\" -I "F:\ZigBee            #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\af\" -I "F:\ZigBee                  #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\nwk\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\sapi\" -I "F:\ZigBee                #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\sec\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\sys\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\zcl\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\stack\zdo\" -I "F:\ZigBee                 #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\zmac\" -I "F:\ZigBee                      #
#                          Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAuto #
#                          mation\SmartSwitchLight\CC2530DB\..\..\..\..\..\Co #
#                          mponents\zmac\f8w\" -Oh --require_prototypes       #
#    List file          =  F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStack #
#                          -CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zstac #
#                          k\HomeAutomation\SmartSwitchLight\CC2530DB\EndDevi #
#                          ceEB\List\zcl_device_info.lst                      #
#    Object file        =  F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStack #
#                          -CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zstac #
#                          k\HomeAutomation\SmartSwitchLight\CC2530DB\EndDevi #
#                          ceEB\Obj\zcl_device_info.r51                       #
#                                                                             #
#                                                                             #
###############################################################################

F:\ZigBee Project\smartSwitch-light\v1.03.1\ZStack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAutomation\SmartSwitchLight\Source\zcl_device_info.c
      1          #include "zcl.h"
      2          #include "ZDObject.h"
      3          #include "zcl_device_info.h"
      4          #include "zcl_onofflight.h"
      5          #include "OnBoard.h"
      6          #include "ZGlobals.h"
      7          #include "ZComDef.h"
      8          
      9          extern byte zclOnOffLight_TaskID;
     10          #define ZCL_TASK_ID zclOnOffLight_TaskID
     11          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     12          afAddrType_t zclIASZoneMotionIR_Coord_nwkAddr;
   \                     zclIASZoneMotionIR_Coord_nwkAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     13          static uint16 gDeviceInfoSendStatus = 0;
   \                     gDeviceInfoSendStatus:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     14          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     15          void zclDeviceInfoInit(void)
   \                     zclDeviceInfoInit:
     16          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     17            gDeviceInfoSendStatus = 0;
   \   000004   90....       MOV     DPTR,#gDeviceInfoSendStatus
   \   000007   E4           CLR     A
   \   000008   F0           MOVX    @DPTR,A
   \   000009   A3           INC     DPTR
   \   00000A   F0           MOVX    @DPTR,A
     18            zclIASZoneMotionIR_Coord_nwkAddr.addrMode = afAddr16Bit;
   \   00000B   90....       MOV     DPTR,#zclIASZoneMotionIR_Coord_nwkAddr + 8
   \   00000E   7402         MOV     A,#0x2
   \   000010   F0           MOVX    @DPTR,A
     19            zclIASZoneMotionIR_Coord_nwkAddr.addr.shortAddr = 0x0000;
   \   000011   90....       MOV     DPTR,#zclIASZoneMotionIR_Coord_nwkAddr
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   F0           MOVX    @DPTR,A
     20            zclIASZoneMotionIR_Coord_nwkAddr.endPoint = 0xF0;
   \   000018   90....       MOV     DPTR,#zclIASZoneMotionIR_Coord_nwkAddr + 9
   \   00001B   74F0         MOV     A,#-0x10
   \   00001D   F0           MOVX    @DPTR,A
     21          }
   \   00001E   D083         POP     DPH
   \   000020   D082         POP     DPL
   \   000022   02....       LJMP    ?BRET
     22          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     23          static void zclActiveEPRsp(void)
   \                     zclActiveEPRsp:
     24          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 73
   \   000005   74B7         MOV     A,#-0x49
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
     25            uint8 pBuf[64];
     26            byte cnt = 0;
     27            zAddrType_t srcAddr;
     28            
     29            srcAddr.addrMode = Addr16Bit;
   \   00000A   7408         MOV     A,#0x8
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   7402         MOV     A,#0x2
   \   000011   F0           MOVX    @DPTR,A
     30            srcAddr.addr.shortAddr = 0x0000;
   \   000012   85..82       MOV     DPL,?XSP + 0
   \   000015   85..83       MOV     DPH,?XSP + 1
   \   000018   E4           CLR     A
   \   000019   F0           MOVX    @DPTR,A
   \   00001A   A3           INC     DPTR
   \   00001B   F0           MOVX    @DPTR,A
     31            
     32            cnt = afNumEndPoints() - 1;
   \   00001C                ; Setup parameters for call to function afNumEndPoints
   \   00001C   12....       LCALL   ??afNumEndPoints?relay
   \   00001F   E9           MOV     A,R1
   \   000020   FE           MOV     R6,A
     33            afEndPoints( (uint8 *)pBuf, true );
   \   000021                ; Setup parameters for call to function afEndPoints
   \   000021   7901         MOV     R1,#0x1
   \   000023   7409         MOV     A,#0x9
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   AA82         MOV     R2,DPL
   \   00002A   AB83         MOV     R3,DPH
   \   00002C   12....       LCALL   ??afEndPoints?relay
     34            ZDP_ActiveEPRsp(0x0, &srcAddr, ZDP_SUCCESS,
     35                            NLME_GetShortAddr(), 
     36                            cnt, (uint8 *)pBuf, 0);
   \   00002F                ; Setup parameters for call to function ZDP_EPRsp
   \   00002F   75..00       MOV     ?V0 + 0,#0x0
   \   000032   78..         MOV     R0,#?V0 + 0
   \   000034   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000037   740A         MOV     A,#0xa
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   8582..       MOV     ?V0 + 0,DPL
   \   00003F   8583..       MOV     ?V0 + 1,DPH
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   74FF         MOV     A,#-0x1
   \   000049   2E           ADD     A,R6
   \   00004A   F5..         MOV     ?V0 + 0,A
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000051                ; Setup parameters for call to function NLME_GetShortAddr
   \   000051   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000054   8A..         MOV     ?V0 + 0,R2
   \   000056   8B..         MOV     ?V0 + 1,R3
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   75..00       MOV     ?V0 + 0,#0x0
   \   000060   78..         MOV     R0,#?V0 + 0
   \   000062   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000065   7407         MOV     A,#0x7
   \   000067   12....       LCALL   ?XSTACK_DISP0_8
   \   00006A   AC82         MOV     R4,DPL
   \   00006C   AD83         MOV     R5,DPH
   \   00006E   7900         MOV     R1,#0x0
   \   000070   7A05         MOV     R2,#0x5
   \   000072   7B80         MOV     R3,#-0x80
   \   000074   12....       LCALL   ??ZDP_EPRsp?relay
   \   000077   7407         MOV     A,#0x7
   \   000079   12....       LCALL   ?DEALLOC_XSTACK8
     37            gDeviceInfoSendStatus++;
   \   00007C   12....       LCALL   ?Subroutine2 & 0xFFFF
     38            
     39            osal_start_timerEx(ZCL_TASK_ID, 
     40                               ZCL_DEVICE_INFO_SEND_EVENT,
     41                               100);
   \                     ??CrossCallReturnLabel_2:
   \   00007F   12....       LCALL   ?Subroutine3 & 0xFFFF
     42          }
   \                     ??CrossCallReturnLabel_4:
   \   000082   7449         MOV     A,#0x49
   \   000084   12....       LCALL   ?DEALLOC_XSTACK8
   \   000087                REQUIRE ?Subroutine0
   \   000087                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#zclOnOffLight_TaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??osal_start_timerEx?relay
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   90....       MOV     DPTR,#gDeviceInfoSendStatus
   \   000003   E0           MOVX    A,@DPTR
   \   000004   2401         ADD     A,#0x1
   \   000006   F0           MOVX    @DPTR,A
   \   000007   A3           INC     DPTR
   \   000008   E0           MOVX    A,@DPTR
   \   000009   3400         ADDC    A,#0x0
   \   00000B   F0           MOVX    @DPTR,A
   \   00000C                ; Setup parameters for call to function osal_start_timerEx
   \   00000C                ; Setup parameters for call to function osal_start_timerEx
   \   00000C   7C64         MOV     R4,#0x64
   \   00000E   7D00         MOV     R5,#0x0
   \   000010   7A00         MOV     R2,#0x0
   \   000012   7B01         MOV     R3,#0x1
   \   000014   22           RET
     43          
     44          static void zclSimpleDescRsp(uint16 endpoint)
     45          {
     46            zdoIncomingMsg_t *imMsg;
     47            uint16 nwkAddr = 0;
     48            
     49            nwkAddr = NLME_GetShortAddr();
     50            
     51            imMsg = (zdoIncomingMsg_t *)osal_msg_allocate( sizeof( zdoIncomingMsg_t ) + 3 );
     52            imMsg->srcAddr.addrMode = Addr16Bit;
     53            imMsg->srcAddr.addr.shortAddr = 0x0000;
     54            imMsg->TransSeq = (uint8)0x00;
     55            imMsg->asdu = (byte*)(((byte*)imMsg) + sizeof( zdoIncomingMsg_t ));
     56            imMsg->asdu[0] = LO_UINT16( nwkAddr );
     57            imMsg->asdu[1] = HI_UINT16( nwkAddr );
     58            imMsg->asdu[2] = endpoint;
     59              
     60            ZDO_ProcessSimpleDescReq(imMsg);
     61            osal_msg_deallocate((uint8 *)imMsg);
     62            
     63            gDeviceInfoSendStatus++;
     64            osal_start_timerEx(ZCL_TASK_ID, 
     65                               ZCL_DEVICE_INFO_SEND_EVENT,
     66                               100);
     67          }
     68          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     69          static endPointDesc_t zclHeartbeatDesc = {
   \                     zclHeartbeatDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for zclHeartbeatDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
     70            ZCL_HEARTBEAT_ENDPOINT,
     71            &ZCL_TASK_ID,
     72            (SimpleDescriptionFormat_t *)&zclOnOffLight0_SimpleDesc,
     73            (afNetworkLatencyReq_t)0
     74          };
     75          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     76          static uint8 zclHeartbeatCounter = 0;
   \                     zclHeartbeatCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     77          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     78          afStatus_t zclSendHeartbeat(void)
   \                     zclSendHeartbeat:
     79          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
     80            afStatus_t stat;
     81            stat = AF_DataRequest(&zclIASZoneMotionIR_Coord_nwkAddr, 
     82                                  &zclHeartbeatDesc,
     83                                  ZCL_HEARTBEAT_CLUSTERID,
     84                                  ZCL_HEARTBEAT_DATA_LEN,
     85                                  (uint8 *)&zclHeartbeatCounter,
     86                                  (uint8 *)&zclHeartbeatCounter,
     87                                  0,
     88                                  AF_DEFAULT_RADIUS);
   \   000005                ; Setup parameters for call to function AF_DataRequest
   \   000005   75..1E       MOV     ?V0 + 0,#0x1e
   \   000008   78..         MOV     R0,#?V0 + 0
   \   00000A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00000D   75....       MOV     ?V0 + 0,#zclHeartbeatCounter & 0xff
   \   000010   75....       MOV     ?V0 + 1,#(zclHeartbeatCounter >> 8) & 0xff
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..01       MOV     ?V0 + 0,#0x1
   \   000020   75..00       MOV     ?V0 + 1,#0x0
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..00       MOV     ?V0 + 0,#0x0
   \   00002B   75..FF       MOV     ?V0 + 1,#-0x1
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7900         MOV     R1,#0x0
   \   000035   7C..         MOV     R4,#zclHeartbeatDesc & 0xff
   \   000037   7D..         MOV     R5,#(zclHeartbeatDesc >> 8) & 0xff
   \   000039   7A..         MOV     R2,#zclIASZoneMotionIR_Coord_nwkAddr & 0xff
   \   00003B   7B..         MOV     R3,#(zclIASZoneMotionIR_Coord_nwkAddr >> 8) & 0xff
   \   00003D   12....       LCALL   ??AF_DataRequest?relay
   \   000040   7409         MOV     A,#0x9
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   FE           MOV     R6,A
     89            
     90            osal_start_timerEx(ZCL_TASK_ID, 
     91                               ZCL_DEVICE_HEARTBEAT_EVENT,
     92                               ZCL_HEARTBEAT_PERIOD);
   \   000047                ; Setup parameters for call to function osal_start_timerEx
   \   000047   7C60         MOV     R4,#0x60
   \   000049   7DEA         MOV     R5,#-0x16
   \   00004B   7A00         MOV     R2,#0x0
   \   00004D   7B02         MOV     R3,#0x2
   \   00004F   12....       LCALL   ?Subroutine3 & 0xFFFF
     93            return stat;
   \                     ??CrossCallReturnLabel_5:
   \   000052   EE           MOV     A,R6
   \   000053   F9           MOV     R1,A
   \   000054   80..         SJMP    ?Subroutine0
     94            
     95          }
     96          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     97          void zclSendDeviceInfo(void)
   \                     zclSendDeviceInfo:
     98          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
     99            switch (gDeviceInfoSendStatus)
   \   000005   90....       MOV     DPTR,#gDeviceInfoSendStatus
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F5..         MOV     ?V0 + 0,A
   \   00000B   A3           INC     DPTR
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F5..         MOV     ?V0 + 1,A
   \   00000F   78..         MOV     R0,#?V0 + 0
   \   000011   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for zclSendDeviceInfo>_0`:
   \   000014   0000         DW        0
   \   000016   02           DB        2
   \   000017   ....         DW        ??zclSendDeviceInfo_0
   \   000019   ....         DW        ??zclSendDeviceInfo_1
   \   00001B   ....         DW        ??zclSendDeviceInfo_2
   \   00001D   ....         DW        ??zclSendDeviceInfo_3
    100            {
    101            case 0:
    102              zclActiveEPRsp();
   \                     ??zclSendDeviceInfo_1:
   \   00001F                ; Setup parameters for call to function zclActiveEPRsp
   \   00001F   12....       LCALL   ??zclActiveEPRsp?relay
    103              break;
   \   000022   8031         SJMP    ??CrossCallReturnLabel_6
    104            case 1:
    105              zclSimpleDescRsp(ONOFFLIGHT0_ENDPOINT);
   \                     ??zclSendDeviceInfo_2:
   \   000024                ; Setup parameters for call to function NLME_GetShortAddr
   \   000024   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000027   7410         MOV     A,#0x10
   \                     ??zclSendDeviceInfo_4:
   \   000029   F0           MOVX    @DPTR,A
   \   00002A                ; Setup parameters for call to function ZDO_ProcessSimpleDescReq
   \   00002A   EE           MOV     A,R6
   \   00002B   FA           MOV     R2,A
   \   00002C   EF           MOV     A,R7
   \   00002D   FB           MOV     R3,A
   \   00002E   12....       LCALL   ??ZDO_ProcessSimpleDescReq?relay
   \   000031                ; Setup parameters for call to function osal_msg_deallocate
   \   000031   EE           MOV     A,R6
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \   000034   FB           MOV     R3,A
   \   000035   12....       LCALL   ??osal_msg_deallocate?relay
   \   000038   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00003B   8015         SJMP    ??zclSendDeviceInfo_5
    106              break;
    107            case 2:
    108              zclSimpleDescRsp(ONOFFLIGHT1_ENDPOINT);
   \                     ??zclSendDeviceInfo_3:
   \   00003D                ; Setup parameters for call to function NLME_GetShortAddr
   \   00003D   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000040   7411         MOV     A,#0x11
   \   000042   80E5         SJMP    ??zclSendDeviceInfo_4
    109              break;
    110            default:
    111              gDeviceInfoSendStatus = 0;
   \                     ??zclSendDeviceInfo_0:
   \   000044   90....       MOV     DPTR,#gDeviceInfoSendStatus
   \   000047   E4           CLR     A
   \   000048   F0           MOVX    @DPTR,A
   \   000049   A3           INC     DPTR
   \   00004A   F0           MOVX    @DPTR,A
    112              osal_start_timerEx(ZCL_TASK_ID, 
    113                               ZCL_DEVICE_HEARTBEAT_EVENT,
    114                               ZCL_HEARTBEAT_PERIOD);
   \   00004B                ; Setup parameters for call to function osal_start_timerEx
   \   00004B   7C60         MOV     R4,#0x60
   \   00004D   7DEA         MOV     R5,#-0x16
   \   00004F   FA           MOV     R2,A
   \   000050   7B02         MOV     R3,#0x2
   \                     ??zclSendDeviceInfo_5:
   \   000052   12....       LCALL   ?Subroutine3 & 0xFFFF
    115              break;
    116            }
    117          }
   \                     ??CrossCallReturnLabel_6:
   \   000055   7F04         MOV     R7,#0x4
   \   000057   02....       LJMP    ?BANKED_LEAVE_XDATA
    118          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    119          void zclFactoryReset(uint8 DataCleanFlag)
   \                     zclFactoryReset:
    120          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    121            static uint8 hasDoReset = 0;
    122            if (hasDoReset)
   \   000007   90....       MOV     DPTR,#??hasDoReset
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   7010         JNZ     ??zclFactoryReset_0
    123              return;
    124            
    125            hasDoReset = 1;
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    126            if(DataCleanFlag)
   \   000010   EE           MOV     A,R6
   \   000011   6007         JZ      ??zclFactoryReset_1
    127            {
    128              zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
   \   000013                ; Setup parameters for call to function zgWriteStartupOptions
   \   000013   7A02         MOV     R2,#0x2
   \   000015   79FF         MOV     R1,#-0x1
   \   000017   12....       LCALL   ??zgWriteStartupOptions?relay
    129            }
    130            SystemResetSoft();
   \                     ??zclFactoryReset_1:
   \   00001A                ; Setup parameters for call to function Onboard_soft_reset
   \   00001A   12....       LCALL   Onboard_soft_reset & 0xFFFF
    131          }
   \                     ??zclFactoryReset_0:
   \   00001D   7F01         MOV     R7,#0x1
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??hasDoReset:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   8B..         MOV     ?V0 + 1,R3
   \   000007                ; Setup parameters for call to function osal_msg_allocate
   \   000007                ; Setup parameters for call to function osal_msg_allocate
   \   000007   7A18         MOV     R2,#0x18
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??osal_msg_allocate?relay
   \   00000E   8A..         MOV     ?V0 + 2,R2
   \   000010   8B..         MOV     ?V0 + 3,R3
   \   000012   AE..         MOV     R6,?V0 + 2
   \   000014   AF..         MOV     R7,?V0 + 3
   \   000016   8E82         MOV     DPL,R6
   \   000018   8F83         MOV     DPH,R7
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   E4           CLR     A
   \   00002E   F0           MOVX    @DPTR,A
   \   00002F   A3           INC     DPTR
   \   000030   F0           MOVX    @DPTR,A
   \   000031   EE           MOV     A,R6
   \   000032   240F         ADD     A,#0xf
   \   000034   F582         MOV     DPL,A
   \   000036   EF           MOV     A,R7
   \   000037   3400         ADDC    A,#0x0
   \   000039   F583         MOV     DPH,A
   \   00003B   E4           CLR     A
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   EE           MOV     A,R6
   \   00003E   2415         ADD     A,#0x15
   \   000040   F8           MOV     R0,A
   \   000041   EF           MOV     A,R7
   \   000042   3400         ADDC    A,#0x0
   \   000044   F9           MOV     R1,A
   \   000045   EE           MOV     A,R6
   \   000046   2413         ADD     A,#0x13
   \   000048   FA           MOV     R2,A
   \   000049   EF           MOV     A,R7
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FB           MOV     R3,A
   \   00004D   8A82         MOV     DPL,R2
   \   00004F   8B83         MOV     DPH,R3
   \   000051   E8           MOV     A,R0
   \   000052   F0           MOVX    @DPTR,A
   \   000053   A3           INC     DPTR
   \   000054   E9           MOV     A,R1
   \   000055   F0           MOVX    @DPTR,A
   \   000056   8882         MOV     DPL,R0
   \   000058   8983         MOV     DPH,R1
   \   00005A   E5..         MOV     A,?V0 + 0
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   E5..         MOV     A,?V0 + 1
   \   00005F   F5..         MOV     ?V0 + 0,A
   \   000061   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000064   E5..         MOV     A,?V0 + 0
   \   000066   F0           MOVX    @DPTR,A
   \   000067   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00006A   A3           INC     DPTR
   \   00006B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   8A82         MOV     DPL,R2
   \   000002   8B83         MOV     DPH,R3
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F8           MOV     R0,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F583         MOV     DPH,A
   \   00000A   8882         MOV     DPL,R0
   \   00000C   A3           INC     DPTR
   \   00000D   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclHeartbeatDesc>`:
   \   000000   EF           DB 239
   \   000001   ....         DW zclOnOffLight_TaskID
   \   000003   ....         DW zclOnOffLight0_SimpleDesc
   \   000005   00           DB 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclDeviceInfoInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclDeviceInfoInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclActiveEPRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclActiveEPRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSendHeartbeat?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSendHeartbeat

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSendDeviceInfo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSendDeviceInfo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclFactoryReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclFactoryReset

   Maximum stack usage in bytes:

     Function                      ISTACK PSTACK XSTACK
     --------                      ------ ------ ------
     zclActiveEPRsp                    0      0    102
       -> afNumEndPoints               0      0    166
       -> afEndPoints                  0      0    166
       -> NLME_GetShortAddr            0      0    174
       -> ZDP_EPRsp                    0      0    180
       -> osal_start_timerEx           0      0    166
     zclDeviceInfoInit                 2      0      0
     zclFactoryReset                   0      0      9
       -> zgWriteStartupOptions        0      0     18
       -> Onboard_soft_reset           0      0     18
     zclSendDeviceInfo                 1      0     12
       -> zclActiveEPRsp               0      0     24
       -> NLME_GetShortAddr            0      0     24
       -> osal_msg_allocate            0      0     24
       -> ZDO_ProcessSimpleDescReq     0      0     24
       -> osal_msg_deallocate          0      0     24
       -> osal_start_timerEx           0      0     24
       -> NLME_GetShortAddr            0      0     24
       -> osal_msg_allocate            0      0     24
       -> ZDO_ProcessSimpleDescReq     0      0     24
       -> osal_msg_deallocate          0      0     24
       -> osal_start_timerEx           0      0     24
       -> osal_start_timerEx           0      0     24
     zclSendHeartbeat                  0      0     19
       -> AF_DataRequest               0      0     38
       -> osal_start_timerEx           0      0     20


   Segment part sizes:

     Function/Label                      Bytes
     --------------                      -----
     zclIASZoneMotionIR_Coord_nwkAddr
                                           12
     gDeviceInfoSendStatus                  2
     zclDeviceInfoInit                     37
     zclActiveEPRsp                       135
     ?Subroutine0                           5
     ?Subroutine3                           9
     ?Subroutine2                          21
     zclHeartbeatDesc                       6
     zclHeartbeatCounter                    1
     zclSendHeartbeat                      86
     zclSendDeviceInfo                     90
     zclFactoryReset                       34
     hasDoReset                             1
     ?Subroutine1                         108
     ?Subroutine4                          14
     ?<Initializer for zclHeartbeatDesc>    6
     ??zclDeviceInfoInit?relay              6
     ??zclActiveEPRsp?relay                 6
     ??zclSendHeartbeat?relay               6
     ??zclSendDeviceInfo?relay              6
     ??zclFactoryReset?relay                6

 
 539 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
   6 bytes in segment XDATA_I
   6 bytes in segment XDATA_ID
  16 bytes in segment XDATA_Z
 
 575 bytes of CODE  memory
  22 bytes of XDATA memory

Errors: none
Warnings: none
